# å®šæ—¶ä»»åŠ¡æµ‹è¯•æŒ‡å—

## å®šæ—¶ä»»åŠ¡å®ç°ä½ç½®

å®šæ—¶ä»»åŠ¡åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­å®ç°ï¼š

### 1. ReportSchedulerService.kt
- **ä½ç½®**: `src/main/kotlin/com/khm/group/center/task/ReportSchedulerService.kt`
- **åŠŸèƒ½**: åŒ…å«æ‰€æœ‰å®šæ—¶æ¨é€ä»»åŠ¡çš„è°ƒåº¦é€»è¾‘

### 2. ReportPushController.kt
- **ä½ç½®**: `src/main/kotlin/com/khm/group/center/controller/api/web/admin/ReportPushController.kt`
- **åŠŸèƒ½**: æä¾›æ‰‹åŠ¨è§¦å‘æ¨é€çš„APIæ¥å£ï¼Œç”¨äºæµ‹è¯•

## å®šæ—¶ä»»åŠ¡é…ç½®

### è‡ªåŠ¨å®šæ—¶ä»»åŠ¡
- **æ˜¨æ—¥æ—¥æŠ¥**: æ¯å¤©æ—©ä¸Š8ç‚¹ (`0 0 8 * * ?`)
- **å‘¨æŠ¥**: æ¯å‘¨ä¸€æ—©ä¸Š9ç‚¹ (`0 0 9 ? * MON`)
- **æœˆæŠ¥**: æ¯æœˆ1å·æ—©ä¸Š10ç‚¹ (`0 0 10 1 * ?`)
- **å¹´æŠ¥**: æ¯å¹´1æœˆ1å·æ—©ä¸Š11ç‚¹ (`0 0 11 1 1 ?`)
- **ç¼“å­˜æ›´æ–°**: æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ (`fixedRate = 3600000`)

## ç®€å•æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨APIæ¥å£æ‰‹åŠ¨è§¦å‘ï¼ˆæ¨èï¼‰

å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®ä»¥ä¸‹APIç«¯ç‚¹ï¼š

```bash
# ç«‹å³æ¨é€ä»Šæ—¥æ—¥æŠ¥
POST http://localhost:8080/api/admin/report/push/today/now

# ç«‹å³æ¨é€æ˜¨æ—¥æ—¥æŠ¥
POST http://localhost:8080/api/admin/report/push/yesterday/now

# ç«‹å³æ¨é€å‘¨æŠ¥
POST http://localhost:8080/api/admin/report/push/weekly/now

# ç«‹å³æ¨é€æœˆæŠ¥
POST http://localhost:8080/api/admin/report/push/monthly/now

# ç«‹å³æ¨é€å¹´æŠ¥
POST http://localhost:8080/api/admin/report/push/yearly/now

# æ›´æ–°ç»Ÿè®¡ç¼“å­˜
POST http://localhost:8080/api/admin/report/push/update-cache
```

### æ–¹æ³•2: ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•

```bash
# æ¨é€æ˜¨æ—¥æ—¥æŠ¥
curl -X POST http://localhost:8080/api/admin/report/push/yesterday/now

# æ¨é€å‘¨æŠ¥
curl -X POST http://localhost:8080/api/admin/report/push/weekly/now

# æ¨é€æœˆæŠ¥
curl -X POST http://localhost:8080/api/admin/report/push/monthly/now
```

### æ–¹æ³•3: ä½¿ç”¨Postmanæˆ–æµè§ˆå™¨æ’ä»¶

1. è®¾ç½®è¯·æ±‚æ–¹æ³•ä¸º `POST`
2. è¾“å…¥å¯¹åº”çš„URL
3. å‘é€è¯·æ±‚

## æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨åº”ç”¨
```bash
./gradlew bootRun
```

### 2. æµ‹è¯•å•ä¸ªæ¨é€
```bash
# æµ‹è¯•æ˜¨æ—¥æ—¥æŠ¥æ¨é€
curl -X POST http://localhost:8080/api/admin/report/push/yesterday/now
```

### 3. æŸ¥çœ‹æ—¥å¿—è¾“å‡º
åœ¨åº”ç”¨æ—¥å¿—ä¸­æŸ¥çœ‹æ¨é€ç»“æœï¼š
- æˆåŠŸ: `âœ… Yesterday report pushed successfully`
- å¤±è´¥: `âŒ Failed to generate yesterday report: [é”™è¯¯ä¿¡æ¯]`

### 4. éªŒè¯ç¼“å­˜åŠŸèƒ½
è¿ç»­è°ƒç”¨ä¸¤æ¬¡ç›¸åŒçš„APIï¼Œè§‚å¯Ÿæ—¥å¿—ï¼š
- ç¬¬ä¸€æ¬¡: `ğŸ”„ ç¼“å­˜æœªå‘½ä¸­ï¼Œé‡æ–°è®¡ç®—æ—¥æŠ¥`
- ç¬¬äºŒæ¬¡: `âœ… ç¼“å­˜å‘½ä¸­ï¼Œä»ç¼“å­˜è·å–æ—¥æŠ¥`

## é¢„æœŸç»“æœ

### æˆåŠŸå“åº”
```json
{
  "result": {
    "message": "Yesterday report pushed successfully",
    "status": "completed"
  }
}
```

### æ—¥å¿—è¾“å‡º
```
âœ… Yesterday report pushed successfully
ğŸ”„ ç¼“å­˜æœªå‘½ä¸­ï¼Œé‡æ–°è®¡ç®—æ—¥æŠ¥ï¼ˆ2024-10-08ï¼‰
ğŸ’¾ æ–°æ—¥æŠ¥å·²ç¼“å­˜ï¼ˆ2024-10-08ï¼‰
âœ… ç¼“å­˜å‘½ä¸­ï¼Œä»ç¼“å­˜è·å–æ—¥æŠ¥ï¼ˆ2024-10-08ï¼‰
```

## æ•…éšœæ’é™¤

### 1. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ
- æ£€æŸ¥Spring Bootæ˜¯å¦å¯ç”¨äº†å®šæ—¶ä»»åŠ¡æ³¨è§£ `@EnableScheduling`
- æ£€æŸ¥åº”ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å®šæ—¶ä»»åŠ¡é…ç½®

### 2. APIè°ƒç”¨å¤±è´¥
- ç¡®è®¤åº”ç”¨å·²å¯åŠ¨å¹¶ç›‘å¬8080ç«¯å£
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### 3. æ¨é€å¤±è´¥
- æ£€æŸ¥Boté…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- æŸ¥çœ‹BotPushServiceçš„æ—¥å¿—è¾“å‡º

## å¿«é€Ÿæµ‹è¯•è„šæœ¬

åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬ `test_push.sh`ï¼š

```bash
#!/bin/bash

BASE_URL="http://localhost:8080/api/admin/report/push"

echo "æµ‹è¯•æ˜¨æ—¥æ—¥æŠ¥æ¨é€..."
curl -X POST $BASE_URL/yesterday/now

echo ""
echo "æµ‹è¯•å‘¨æŠ¥æ¨é€..."
curl -X POST $BASE_URL/weekly/now

echo ""
echo "æµ‹è¯•ç¼“å­˜æ›´æ–°..."
curl -X POST $BASE_URL/update-cache
```

è¿è¡Œè„šæœ¬ï¼š
```bash
chmod +x test_push.sh
./test_push.sh
```

è¿™ä¸ªæŒ‡å—æä¾›äº†æœ€ç®€å•ç›´æ¥çš„æµ‹è¯•æ–¹æ³•ï¼Œä½ å¯ä»¥ç«‹å³å¼€å§‹æµ‹è¯•å®šæ—¶æ¨é€åŠŸèƒ½ã€‚